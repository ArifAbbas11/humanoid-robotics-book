"use strict";(globalThis.webpackChunkhumanoid_robotics_book=globalThis.webpackChunkhumanoid_robotics_book||[]).push([[1968],{5099:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>t,metadata:()=>l,toc:()=>_});var a=e(4848),i=e(8453);const t={},o="Mini-Project: Implementing Navigation for a Humanoid Robot",l={id:"ai-navigation/mini-project",title:"Mini-Project: Implementing Navigation for a Humanoid Robot",description:"Overview",source:"@site/docs/ai-navigation/mini-project.md",sourceDirName:"ai-navigation",slug:"/ai-navigation/mini-project",permalink:"/humanoid-robotics-book/ai-navigation/mini-project",draft:!1,unlisted:!1,editUrl:"https://github.com/ArifAbbas11/humanoid-robotics-book/tree/main/docs/ai-navigation/mini-project.md",tags:[],version:"current",frontMatter:{},sidebar:"bookSidebar",previous:{title:"Navigation Planning",permalink:"/humanoid-robotics-book/ai-navigation/navigation-planning"},next:{title:"Troubleshooting AI Navigation for Humanoid Robots",permalink:"/humanoid-robotics-book/ai-navigation/troubleshooting"}},s={},_=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create the Robot Model with Navigation Sensors",id:"step-1-create-the-robot-model-with-navigation-sensors",level:2},{value:"Step 2: Create Navigation Configuration",id:"step-2-create-navigation-configuration",level:2},{value:"Step 3: Create the Navigation Controller",id:"step-3-create-the-navigation-controller",level:2},{value:"Step 4: Create the Launch File",id:"step-4-create-the-launch-file",level:2},{value:"Step 5: Build and Run the Navigation System",id:"step-5-build-and-run-the-navigation-system",level:2},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(n){const r={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.RP)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.h1,{id:"mini-project-implementing-navigation-for-a-humanoid-robot",children:"Mini-Project: Implementing Navigation for a Humanoid Robot"}),"\n",(0,a.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(r.p,{children:"In this mini-project, you'll implement a complete navigation system for a humanoid robot that includes path planning, localization, mapping, and control. You'll create a robot that can navigate to specified goals while avoiding obstacles and maintaining balance."}),"\n",(0,a.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Completed previous AI navigation sections"}),"\n",(0,a.jsx)(r.li,{children:"ROS 2 Humble installed"}),"\n",(0,a.jsx)(r.li,{children:"Gazebo simulation environment"}),"\n",(0,a.jsx)(r.li,{children:"Basic understanding of humanoid kinematics"}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"step-1-create-the-robot-model-with-navigation-sensors",children:"Step 1: Create the Robot Model with Navigation Sensors"}),"\n",(0,a.jsxs)(r.p,{children:["Create ",(0,a.jsx)(r.code,{children:"humanoid_navigation.urdf.xacro"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="humanoid_navigator">\r\n\r\n  \x3c!-- Base link --\x3e\r\n  <link name="base_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.3 0.2 0.6"/>\r\n      </geometry>\r\n      <material name="blue">\r\n        <color rgba="0 0 1 0.8"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.3 0.2 0.6"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="50"/>\r\n      <inertia ixx="2.5" ixy="0" ixz="0" iyy="3.5" iyz="0" izz="1.5"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- Head with camera --\x3e\r\n  <link name="head">\r\n    <visual>\r\n      <geometry>\r\n        <sphere radius="0.1"/>\r\n      </geometry>\r\n      <material name="white">\r\n        <color rgba="1 1 1 0.8"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <sphere radius="0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="2"/>\r\n      <inertia ixx="0.004" ixy="0" ixz="0" iyy="0.004" iyz="0" izz="0.004"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="neck_joint" type="revolute">\r\n    <parent link="base_link"/>\r\n    <child link="head"/>\r\n    <origin xyz="0 0 0.3" rpy="0 0 0"/>\r\n    <axis xyz="0 1 0"/>\r\n    <limit lower="-0.5" upper="0.5" effort="100" velocity="1"/>\r\n  </joint>\r\n\r\n  \x3c!-- Camera in the head --\x3e\r\n  <link name="camera_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.05 0.05 0.05"/>\r\n      </geometry>\r\n      <material name="black">\r\n        <color rgba="0 0 0 0.8"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.05 0.05 0.05"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="0.1"/>\r\n      <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="camera_joint" type="fixed">\r\n    <parent link="head"/>\r\n    <child link="camera_link"/>\r\n    <origin xyz="0.05 0 0" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- LIDAR on top of head --\x3e\r\n  <link name="lidar_link">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder radius="0.05" length="0.05"/>\r\n      </geometry>\r\n      <material name="red">\r\n        <color rgba="1 0 0 0.8"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <cylinder radius="0.05" length="0.05"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="0.5"/>\r\n      <inertia ixx="0.0002" ixy="0" ixz="0" iyy="0.0002" iyz="0" izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="lidar_joint" type="fixed">\r\n    <parent link="head"/>\r\n    <child link="lidar_link"/>\r\n    <origin xyz="0 0 0.1" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- IMU in the torso --\x3e\r\n  <link name="imu_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.02 0.02 0.02"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.02 0.02 0.02"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="0.05"/>\r\n      <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="imu_joint" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="imu_link"/>\r\n    <origin xyz="0 0 0" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- Left leg --\x3e\r\n  <link name="left_hip">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.1"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="5"/>\r\n      <inertia ixx="0.02" ixy="0" ixz="0" iyy="0.02" iyz="0" izz="0.02"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="left_hip_joint" type="revolute">\r\n    <parent link="base_link"/>\r\n    <child link="left_hip"/>\r\n    <origin xyz="0 0.1 -0.3" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="-1.57" upper="1.57" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  <link name="left_knee">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.3"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.3"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="3"/>\r\n      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.01"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="left_knee_joint" type="revolute">\r\n    <parent link="left_hip"/>\r\n    <child link="left_knee"/>\r\n    <origin xyz="0 0 -0.2" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="0" upper="2.35" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  <link name="left_ankle">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.2 0.1 0.05"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.2 0.1 0.05"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="2"/>\r\n      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="left_ankle_joint" type="revolute">\r\n    <parent link="left_knee"/>\r\n    <child link="left_ankle"/>\r\n    <origin xyz="0 0 -0.2" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="-0.5" upper="0.5" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  \x3c!-- Right leg --\x3e\r\n  <link name="right_hip">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.1"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="5"/>\r\n      <inertia ixx="0.02" ixy="0" ixz="0" iyy="0.02" iyz="0" izz="0.02"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="right_hip_joint" type="revolute">\r\n    <parent link="base_link"/>\r\n    <child link="right_hip"/>\r\n    <origin xyz="0 -0.1 -0.3" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="-1.57" upper="1.57" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  <link name="right_knee">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.3"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.1 0.1 0.3"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="3"/>\r\n      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.01"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="right_knee_joint" type="revolute">\r\n    <parent link="right_hip"/>\r\n    <child link="right_knee"/>\r\n    <origin xyz="0 0 -0.2" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="0" upper="2.35" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  <link name="right_ankle">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.2 0.1 0.05"/>\r\n      </geometry>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.2 0.1 0.05"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="2"/>\r\n      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  <joint name="right_ankle_joint" type="revolute">\r\n    <parent link="right_knee"/>\r\n    <child link="right_ankle"/>\r\n    <origin xyz="0 0 -0.2" rpy="0 0 0"/>\r\n    <axis xyz="1 0 0"/>\r\n    <limit lower="-0.5" upper="0.5" effort="100" velocity="2"/>\r\n  </joint>\r\n\r\n  \x3c!-- Gazebo plugins --\x3e\r\n  <gazebo reference="camera_link">\r\n    <sensor type="camera" name="camera1">\r\n      <update_rate>30.0</update_rate>\r\n      <camera name="head">\r\n        <horizontal_fov>1.3962634</horizontal_fov>\r\n        <image>\r\n          <width>640</width>\r\n          <height>480</height>\r\n          <format>R8G8B8</format>\r\n        </image>\r\n        <clip>\r\n          <near>0.02</near>\r\n          <far>300</far>\r\n        </clip>\r\n        <noise>\r\n          <type>gaussian</type>\r\n          <mean>0.0</mean>\r\n          <stddev>0.007</stddev>\r\n        </noise>\r\n      </camera>\r\n      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">\r\n        <frame_name>camera_link</frame_name>\r\n        <topic_name>camera/image_raw</topic_name>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n  <gazebo reference="lidar_link">\r\n    <sensor type="ray" name="lidar_sensor">\r\n      <pose>0 0 0 0 0 0</pose>\r\n      <visualize>true</visualize>\r\n      <update_rate>10</update_rate>\r\n      <ray>\r\n        <scan>\r\n          <horizontal>\r\n            <samples>720</samples>\r\n            <resolution>1</resolution>\r\n            <min_angle>-3.14159</min_angle>\r\n            <max_angle>3.14159</max_angle>\r\n          </horizontal>\r\n        </scan>\r\n        <range>\r\n          <min>0.10</min>\r\n          <max>30.0</max>\r\n          <resolution>0.01</resolution>\r\n        </range>\r\n        <noise>\r\n          <type>gaussian</type>\r\n          <mean>0.0</mean>\r\n          <stddev>0.01</stddev>\r\n        </noise>\r\n      </ray>\r\n      <plugin name="lidar_controller" filename="libgazebo_ros_laser.so">\r\n        <topic_name>scan</topic_name>\r\n        <frame_name>lidar_link</frame_name>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n  <gazebo reference="imu_link">\r\n    <sensor type="imu" name="imu_sensor">\r\n      <always_on>true</always_on>\r\n      <update_rate>100</update_rate>\r\n      <visualize>false</visualize>\r\n      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">\r\n        <topicName>imu</topicName>\r\n        <bodyName>base_link</bodyName>\r\n        <updateRateHZ>100.0</updateRateHZ>\r\n        <gaussianNoise>0.01</gaussianNoise>\r\n        <xyzOffset>0 0 0</xyzOffset>\r\n        <rpyOffset>0 0 0</rpyOffset>\r\n        <frameName>imu_link</frameName>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n  \x3c!-- Control plugin for joints --\x3e\r\n  <gazebo>\r\n    <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">\r\n      <update_rate>30</update_rate>\r\n      <joint_name>left_hip_joint</joint_name>\r\n      <joint_name>left_knee_joint</joint_name>\r\n      <joint_name>left_ankle_joint</joint_name>\r\n      <joint_name>right_hip_joint</joint_name>\r\n      <joint_name>right_knee_joint</joint_name>\r\n      <joint_name>right_ankle_joint</joint_name>\r\n      <joint_name>neck_joint</joint_name>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n</robot>\n'})}),"\n",(0,a.jsx)(r.h2,{id:"step-2-create-navigation-configuration",children:"Step 2: Create Navigation Configuration"}),"\n",(0,a.jsxs)(r.p,{children:["Create ",(0,a.jsx)(r.code,{children:"config/navigation.yaml"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:'amcl:\r\n  ros__parameters:\r\n    use_sim_time: True\r\n    alpha1: 0.2\r\n    alpha2: 0.2\r\n    alpha3: 0.2\r\n    alpha4: 0.2\r\n    alpha5: 0.2\r\n    base_frame_id: "base_link"\r\n    beam_skip_distance: 0.5\r\n    beam_skip_error_threshold: 0.9\r\n    beam_skip_threshold: 0.3\r\n    do_beamskip: false\r\n    global_frame_id: "map"\r\n    lambda_short: 0.1\r\n    likelihood_max_dist: 2.0\r\n    set_initial_pose: true\r\n    initial_pose:\r\n      x: 0.0\r\n      y: 0.0\r\n      z: 0.0\r\n      yaw: 0.0\r\n    tf_broadcast: true\r\n    transform_tolerance: 1.0\r\n    update_min_a: 0.2\r\n    update_min_d: 0.25\r\n    z_hit: 0.5\r\n    z_max: 0.05\r\n    z_rand: 0.5\r\n    z_short: 0.05\r\n    scan_topic: scan\r\n\r\nbt_navigator:\r\n  ros__parameters:\r\n    use_sim_time: True\r\n    global_frame: map\r\n    robot_base_frame: base_link\r\n    odom_topic: /odom\r\n    default_bt_xml_filename: "navigate_w_replanning_and_recovery.xml"\r\n    plugin_lib_names:\r\n    - nav2_compute_path_to_pose_action_bt_node\r\n    - nav2_follow_path_action_bt_node\r\n    - nav2_back_up_action_bt_node\r\n    - nav2_spin_action_bt_node\r\n    - nav2_wait_action_bt_node\r\n    - nav2_clear_costmap_service_bt_node\r\n    - nav2_is_stuck_condition_bt_node\r\n    - nav2_goal_reached_condition_bt_node\r\n    - nav2_goal_updated_condition_bt_node\r\n    - nav2_initial_pose_received_condition_bt_node\r\n    - nav2_reinitialize_global_localization_service_bt_node\r\n    - nav2_rate_controller_bt_node\r\n    - nav2_distance_controller_bt_node\r\n    - nav2_speed_controller_bt_node\r\n    - nav2_truncate_path_action_bt_node\r\n    - nav2_goal_updater_node_bt_node\r\n    - nav2_recovery_node_bt_node\r\n    - nav2_pipeline_sequence_bt_node\r\n    - nav2_round_robin_node_bt_node\r\n    - nav2_transform_available_condition_bt_node\r\n    - nav2_time_expired_condition_bt_node\r\n    - nav2_path_expiring_timer_condition\r\n    - nav2_distance_traveled_condition_bt_node\r\n    - nav2_single_trigger_bt_node\r\n    - nav2_is_battery_low_condition_bt_node\r\n    - nav2_navigate_through_poses_action_bt_node\r\n    - nav2_navigate_to_pose_action_bt_node\r\n    - nav2_remove_passed_goals_action_bt_node\r\n    - nav2_planner_selector_bt_node\r\n    - nav2_controller_selector_bt_node\r\n    - nav2_goal_checker_selector_bt_node\r\n\r\ncontroller_server:\r\n  ros__parameters:\r\n    use_sim_time: True\r\n    controller_frequency: 20.0\r\n    min_x_velocity_threshold: 0.001\r\n    min_y_velocity_threshold: 0.5\r\n    min_theta_velocity_threshold: 0.001\r\n    progress_checker_plugin: "progress_checker"\r\n    goal_checker_plugin: "goal_checker"\r\n    controller_plugins: ["FollowPath"]\r\n\r\n    # Humanoid-specific controller\r\n    FollowPath:\r\n      plugin: "humanoid_controller/HumanoidController"\r\n      # Balance control parameters\r\n      balance_kp: 1.0\r\n      balance_ki: 0.1\r\n      balance_kd: 0.05\r\n      # Walking parameters\r\n      step_height: 0.05\r\n      step_length: 0.3\r\n      step_timing: 0.8\r\n      max_linear_speed: 0.5\r\n      max_angular_speed: 0.5\r\n\r\nlocal_costmap:\r\n  local_costmap:\r\n    ros__parameters:\r\n      update_frequency: 5.0\r\n      publish_frequency: 2.0\r\n      global_frame: odom\r\n      robot_base_frame: base_link\r\n      use_sim_time: True\r\n      rolling_window: true\r\n      width: 10\r\n      height: 10\r\n      resolution: 0.05\r\n      robot_radius: 0.3\r\n      plugins: ["voxel_layer", "inflation_layer"]\r\n      inflation_layer:\r\n        plugin: "nav2_costmap_2d::InflationLayer"\r\n        cost_scaling_factor: 3.0\r\n        inflation_radius: 0.55\r\n      voxel_layer:\r\n        plugin: "nav2_costmap_2d::VoxelLayer"\r\n        enabled: True\r\n        publish_voxel_map: False\r\n        origin_z: 0.0\r\n        z_resolution: 0.05\r\n        z_voxels: 16\r\n        max_obstacle_height: 2.0\r\n        mark_threshold: 0\r\n        observation_sources: scan\r\n        scan:\r\n          topic: /scan\r\n          max_obstacle_height: 2.0\r\n          clearing: True\r\n          marking: True\r\n          data_type: "LaserScan"\r\n          raytrace_max_range: 3.0\r\n          raytrace_min_range: 0.0\r\n          obstacle_max_range: 2.5\r\n          obstacle_min_range: 0.0\r\n\r\nglobal_costmap:\r\n  global_costmap:\r\n    ros__parameters:\r\n      update_frequency: 1.0\r\n      publish_frequency: 1.0\r\n      global_frame: map\r\n      robot_base_frame: base_link\r\n      use_sim_time: True\r\n      robot_radius: 0.3\r\n      resolution: 0.05\r\n      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\r\n      obstacle_layer:\r\n        plugin: "nav2_costmap_2d::ObstacleLayer"\r\n        enabled: True\r\n        observation_sources: scan\r\n        scan:\r\n          topic: /scan\r\n          max_obstacle_height: 2.0\r\n          clearing: True\r\n          marking: True\r\n          data_type: "LaserScan"\r\n          raytrace_max_range: 3.0\r\n          raytrace_min_range: 0.0\r\n          obstacle_max_range: 2.5\r\n          obstacle_min_range: 0.0\r\n      static_layer:\r\n        plugin: "nav2_costmap_2d::StaticLayer"\r\n        map_subscribe_transient_local: True\r\n      inflation_layer:\r\n        plugin: "nav2_costmap_2d::InflationLayer"\r\n        cost_scaling_factor: 3.0\r\n        inflation_radius: 0.55\r\n\r\nplanner_server:\r\n  ros__parameters:\r\n    expected_planner_frequency: 20.0\r\n    use_sim_time: True\r\n    planner_plugins: ["GridBased"]\r\n    GridBased:\r\n      plugin: "nav2_navfn_planner/NavfnPlanner"\r\n      tolerance: 0.5\r\n      use_astar: false\r\n      allow_unknown: true\n'})}),"\n",(0,a.jsx)(r.h2,{id:"step-3-create-the-navigation-controller",children:"Step 3: Create the Navigation Controller"}),"\n",(0,a.jsxs)(r.p,{children:["Create ",(0,a.jsx)(r.code,{children:"humanoid_controller.py"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist, PoseStamped\r\nfrom nav_msgs.msg import Odometry\r\nfrom sensor_msgs.msg import LaserScan, Imu\r\nfrom tf2_ros import TransformBroadcaster\r\nimport numpy as np\r\nfrom scipy.spatial.transform import Rotation as R\r\nimport math\r\n\r\nclass HumanoidController(Node):\r\n    def __init__(self):\r\n        super().__init__('humanoid_controller')\r\n\r\n        # Parameters\r\n        self.declare_parameter('balance_kp', 1.0)\r\n        self.declare_parameter('balance_ki', 0.1)\r\n        self.declare_parameter('balance_kd', 0.05)\r\n        self.declare_parameter('step_height', 0.05)\r\n        self.declare_parameter('step_length', 0.3)\r\n        self.declare_parameter('step_timing', 0.8)\r\n        self.declare_parameter('max_linear_speed', 0.5)\r\n        self.declare_parameter('max_angular_speed', 0.5)\r\n\r\n        self.balance_kp = self.get_parameter('balance_kp').value\r\n        self.balance_ki = self.get_parameter('balance_ki').value\r\n        self.balance_kd = self.get_parameter('balance_kd').value\r\n        self.step_height = self.get_parameter('step_height').value\r\n        self.step_length = self.get_parameter('step_length').value\r\n        self.step_timing = self.get_parameter('step_timing').value\r\n        self.max_linear_speed = self.get_parameter('max_linear_speed').value\r\n        self.max_angular_speed = self.get_parameter('max_angular_speed').value\r\n\r\n        # Subscribers\r\n        self.cmd_vel_sub = self.create_subscription(\r\n            Twist,\r\n            'cmd_vel',\r\n            self.cmd_vel_callback,\r\n            10\r\n        )\r\n\r\n        self.odom_sub = self.create_subscription(\r\n            Odometry,\r\n            'odom',\r\n            self.odom_callback,\r\n            10\r\n        )\r\n\r\n        self.imu_sub = self.create_subscription(\r\n            Imu,\r\n            'imu',\r\n            self.imu_callback,\r\n            10\r\n        )\r\n\r\n        self.scan_sub = self.create_subscription(\r\n            LaserScan,\r\n            'scan',\r\n            self.scan_callback,\r\n            10\r\n        )\r\n\r\n        # Publishers\r\n        self.cmd_vel_pub = self.create_publisher(Twist, 'cmd_vel_out', 10)\r\n\r\n        # Controller state\r\n        self.current_pose = None\r\n        self.current_twist = None\r\n        self.imu_data = None\r\n        self.scan_data = None\r\n        self.balance_error_sum = 0.0\r\n        self.prev_balance_error = 0.0\r\n\r\n        # Timer for control loop\r\n        self.control_timer = self.create_timer(0.05, self.control_loop)  # 20Hz\r\n\r\n        self.get_logger().info('Humanoid Navigation Controller initialized')\r\n\r\n    def cmd_vel_callback(self, msg):\r\n        \"\"\"Handle velocity commands from navigation system\"\"\"\r\n        self.desired_twist = msg\r\n\r\n    def odom_callback(self, msg):\r\n        \"\"\"Handle odometry data\"\"\"\r\n        self.current_pose = msg.pose.pose\r\n        self.current_twist = msg.twist.twist\r\n\r\n    def imu_callback(self, msg):\r\n        \"\"\"Handle IMU data for balance control\"\"\"\r\n        self.imu_data = msg\r\n\r\n    def scan_callback(self, msg):\r\n        \"\"\"Handle laser scan data for obstacle detection\"\"\"\r\n        self.scan_data = msg\r\n\r\n    def compute_balance_control(self):\r\n        \"\"\"Compute balance control based on IMU data\"\"\"\r\n        if self.imu_data is None:\r\n            return 0.0\r\n\r\n        # Extract roll and pitch from IMU quaternion\r\n        orientation = self.imu_data.orientation\r\n        r = R.from_quat([\r\n            orientation.x,\r\n            orientation.y,\r\n            orientation.z,\r\n            orientation.w\r\n        ])\r\n        roll, pitch, yaw = r.as_euler('xyz')\r\n\r\n        # Balance error (we want to maintain upright position)\r\n        balance_error = pitch  # Using pitch as primary balance measure\r\n\r\n        # PID control for balance\r\n        self.balance_error_sum += balance_error * 0.05  # dt = 0.05s\r\n        balance_error_derivative = (balance_error - self.prev_balance_error) / 0.05\r\n\r\n        balance_control = (\r\n            self.balance_kp * balance_error +\r\n            self.balance_ki * self.balance_error_sum +\r\n            self.balance_kd * balance_error_derivative\r\n        )\r\n\r\n        self.prev_balance_error = balance_error\r\n        return balance_control\r\n\r\n    def check_obstacles(self):\r\n        \"\"\"Check for obstacles in the path\"\"\"\r\n        if self.scan_data is None:\r\n            return False\r\n\r\n        # Check forward direction (front 30 degrees)\r\n        ranges = self.scan_data.ranges\r\n        angle_min = self.scan_data.angle_min\r\n        angle_increment = self.scan_data.angle_increment\r\n\r\n        # Get indices for front 30 degrees\r\n        front_start = int((0 - 15 * math.pi/180 - angle_min) / angle_increment)\r\n        front_end = int((0 + 15 * math.pi/180 - angle_min) / angle_increment)\r\n\r\n        if 0 <= front_start < len(ranges) and 0 <= front_end < len(ranges):\r\n            front_ranges = ranges[front_start:front_end]\r\n            min_range = min(front_ranges) if front_ranges else float('inf')\r\n\r\n            # If obstacle is closer than 0.5m, consider it a problem\r\n            return min_range < 0.5\r\n\r\n        return False\r\n\r\n    def control_loop(self):\r\n        \"\"\"Main control loop\"\"\"\r\n        if self.current_pose is None or self.desired_twist is None:\r\n            return\r\n\r\n        cmd_vel = Twist()\r\n\r\n        # Check for obstacles and adjust if needed\r\n        if self.check_obstacles():\r\n            # Stop and rotate to find clear path\r\n            cmd_vel.linear.x = 0.0\r\n            cmd_vel.angular.z = 0.5  # Rotate to find clear path\r\n        else:\r\n            # Apply desired velocity with limits\r\n            cmd_vel.linear.x = max(-self.max_linear_speed,\r\n                                  min(self.max_linear_speed, self.desired_twist.linear.x))\r\n            cmd_vel.angular.z = max(-self.max_angular_speed,\r\n                                   min(self.max_angular_speed, self.desired_twist.angular.z))\r\n\r\n        # Apply balance control to angular velocity\r\n        balance_correction = self.compute_balance_control()\r\n        cmd_vel.angular.z += balance_correction\r\n\r\n        # Publish the command\r\n        self.cmd_vel_pub.publish(cmd_vel)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = HumanoidController()\r\n\r\n    try:\r\n        rclpy.spin(controller)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        controller.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-4-create-the-launch-file",children:"Step 4: Create the Launch File"}),"\n",(0,a.jsxs)(r.p,{children:["Create ",(0,a.jsx)(r.code,{children:"launch/humanoid_navigation.launch.py"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription\r\nfrom launch.conditions import IfCondition\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\r\nfrom launch_ros.actions import Node\r\nfrom launch_ros.substitutions import FindPackageShare\r\nfrom nav2_common.launch import RewrittenYaml\r\n\r\ndef generate_launch_description():\r\n    ld = LaunchDescription()\r\n\r\n    # Launch arguments\r\n    use_sim_time = LaunchConfiguration('use_sim_time', default='true')\r\n    params_file = LaunchConfiguration('params_file')\r\n    autostart = LaunchConfiguration('autostart', default='true')\r\n    use_composition = LaunchConfiguration('use_composition', default='True')\r\n    container_name = LaunchConfiguration('container_name', default='nav2_container')\r\n\r\n    ld.add_action(DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='true',\r\n        description='Use simulation (Gazebo) clock if true'))\r\n\r\n    ld.add_action(DeclareLaunchArgument(\r\n        'params_file',\r\n        default_value=PathJoinSubstitution([\r\n            FindPackageShare('my_robot_pkg'),\r\n            'config',\r\n            'navigation.yaml'\r\n        ]),\r\n        description='Full path to the ROS2 parameters file to use for all launched nodes'))\r\n\r\n    ld.add_action(DeclareLaunchArgument(\r\n        'autostart',\r\n        default_value='true',\r\n        description='Automatically startup the nav2 stack'))\r\n\r\n    # Launch Gazebo\r\n    gazebo = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource([\r\n            PathJoinSubstitution([\r\n                FindPackageShare('gazebo_ros'),\r\n                'launch',\r\n                'gazebo.launch.py'\r\n            ])\r\n        ]),\r\n    )\r\n    ld.add_action(gazebo)\r\n\r\n    # Spawn robot in Gazebo\r\n    spawn_entity = Node(\r\n        package='gazebo_ros',\r\n        executable='spawn_entity.py',\r\n        arguments=[\r\n            '-topic', 'robot_description',\r\n            '-entity', 'humanoid_navigator',\r\n            '-x', '0', '-y', '0', '-z', '0.5'\r\n        ],\r\n        output='screen'\r\n    )\r\n    ld.add_action(spawn_entity)\r\n\r\n    # Robot state publisher\r\n    robot_state_publisher = Node(\r\n        package='robot_state_publisher',\r\n        executable='robot_state_publisher',\r\n        name='robot_state_publisher',\r\n        output='screen',\r\n        parameters=[{'use_sim_time': use_sim_time}]\r\n    )\r\n    ld.add_action(robot_state_publisher)\r\n\r\n    # Joint state publisher\r\n    joint_state_publisher = Node(\r\n        package='joint_state_publisher',\r\n        executable='joint_state_publisher',\r\n        name='joint_state_publisher',\r\n        parameters=[{'use_sim_time': use_sim_time}],\r\n        output='screen'\r\n    )\r\n    ld.add_action(joint_state_publisher)\r\n\r\n    # Navigation2\r\n    navigation2 = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource([\r\n            PathJoinSubstitution([\r\n                FindPackageShare('nav2_bringup'),\r\n                'launch',\r\n                'navigation_launch.py'\r\n            ])\r\n        ]),\r\n        launch_arguments={\r\n            'use_sim_time': use_sim_time,\r\n            'params_file': params_file,\r\n            'autostart': autostart,\r\n            'use_composition': use_composition,\r\n            'container_name': container_name\r\n        }.items()\r\n    )\r\n    ld.add_action(navigation2)\r\n\r\n    # SLAM Toolbox (for mapping)\r\n    slam_toolbox = Node(\r\n        package='slam_toolbox',\r\n        executable='async_slam_toolbox_node',\r\n        name='slam_toolbox',\r\n        parameters=[\r\n            PathJoinSubstitution([\r\n                FindPackageShare('my_robot_pkg'),\r\n                'config',\r\n                'slam.yaml'\r\n            ])\r\n        ],\r\n        output='screen'\r\n    )\r\n    ld.add_action(slam_toolbox)\r\n\r\n    # Humanoid controller\r\n    humanoid_controller = Node(\r\n        package='my_robot_pkg',\r\n        executable='humanoid_controller',\r\n        name='humanoid_controller',\r\n        parameters=[{\r\n            'use_sim_time': use_sim_time,\r\n            'balance_kp': 1.0,\r\n            'balance_ki': 0.1,\r\n            'balance_kd': 0.05,\r\n            'step_height': 0.05,\r\n            'step_length': 0.3,\r\n            'step_timing': 0.8\r\n        }],\r\n        output='screen'\r\n    )\r\n    ld.add_action(humanoid_controller)\r\n\r\n    # RViz\r\n    rviz_config = PathJoinSubstitution([\r\n        FindPackageShare('my_robot_pkg'),\r\n        'rviz',\r\n        'navigation.rviz'\r\n    ])\r\n    rviz = Node(\r\n        package='rviz2',\r\n        executable='rviz2',\r\n        name='rviz2',\r\n        arguments=['-d', rviz_config],\r\n        parameters=[{'use_sim_time': use_sim_time}]\r\n    )\r\n    ld.add_action(rviz)\r\n\r\n    return ld\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-5-build-and-run-the-navigation-system",children:"Step 5: Build and Run the Navigation System"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsx)(r.li,{children:"Build your ROS 2 package:"}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_ws\r\ncolcon build --packages-select my_robot_pkg\r\nsource install/setup.bash\n"})}),"\n",(0,a.jsxs)(r.ol,{start:"2",children:["\n",(0,a.jsx)(r.li,{children:"Launch the navigation system:"}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"ros2 launch my_robot_pkg humanoid_navigation.launch.py\n"})}),"\n",(0,a.jsxs)(r.ol,{start:"3",children:["\n",(0,a.jsx)(r.li,{children:"In another terminal, send a navigation goal:"}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Use RViz2 to set a 2D Nav Goal, or send a goal programmatically\r\nros2 run nav2_msgs action_client\n"})}),"\n",(0,a.jsx)(r.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Robot model appears in Gazebo with all sensors"}),"\n",(0,a.jsx)(r.li,{children:"Navigation system initializes and waits for goals"}),"\n",(0,a.jsx)(r.li,{children:"Robot plans paths and executes navigation while maintaining balance"}),"\n",(0,a.jsx)(r.li,{children:"Obstacle avoidance works when obstacles are detected"}),"\n",(0,a.jsx)(r.li,{children:"Robot successfully reaches specified goals"}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(r.p,{children:"If the navigation system doesn't work properly:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsx)(r.li,{children:"Check that all required ROS 2 packages are installed"}),"\n",(0,a.jsx)(r.li,{children:"Verify sensor data is being published correctly"}),"\n",(0,a.jsx)(r.li,{children:"Check that TF transforms are properly configured"}),"\n",(0,a.jsx)(r.li,{children:"Ensure the robot model has appropriate physical properties"}),"\n",(0,a.jsx)(r.li,{children:"Verify navigation parameters are tuned for humanoid locomotion"}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(r.p,{children:["Continue to ",(0,a.jsx)(r.a,{href:"/humanoid-robotics-book/ai-navigation/troubleshooting",children:"Troubleshooting"})," to learn about common navigation issues and solutions."]})]})}function m(n={}){const{wrapper:r}={...(0,i.RP)(),...n.components};return r?(0,a.jsx)(r,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},8453:(n,r,e)=>{e.d(r,{RP:()=>t});var a=e(6540);const i=a.createContext({});function t(n){const r=a.useContext(i);return a.useMemo(()=>"function"==typeof n?n(r):{...r,...n},[r,n])}}}]);